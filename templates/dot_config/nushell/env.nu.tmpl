if (
  $env
  | default "false" "DOTFILES_ENV_LOADED"
  | get "DOTFILES_ENV_LOADED"
) != "true" {
  {{- if (eq .chezmoi.os "darwin") }}
  {{-   with $envs := (cat
          (includeTemplate "remove_dot_chezmoidata/env.darwin.tmpl" .)
  ) }}
  {{-     $envs
          | replaceAllRegex "^" "\n"
          | replaceAllRegex "\\$\\{(.+?):-(.+)\\}" "($$env | default $$\"$2\" \"$1\" | get \"$1\")"
          | replaceAllRegex "\\$\\{(.+)\\}" "($$env.$1)"
          | replaceAllRegex "\n(.*?)=\"(.+)\"" "\n  $$env.$1 = $\"$2\""
  }}
  {{-   end }}
  {{- else if (eq .chezmoi.os "linux") }}
  {{-   with $envs := (cat
          (includeTemplate "remove_dot_chezmoidata/env.linux.tmpl" .)
  ) }}
  {{-     $envs
          | replaceAllRegex "^" "\n"
          | replaceAllRegex "\\$\\{(.+?):-(.+)\\}" "($$env | default $$\"$2\" \"$1\" | get \"$1\")"
          | replaceAllRegex "\\$\\{(.+)\\}" "($$env.$1)"
          | replaceAllRegex "\n(.*?)=\"(.+)\"" "\n  $$env.$1 = $\"$2\""
  }}
  {{-   end }}
  {{- end -}}
}
