if (
  $env
  | default "false" "DOTFILES_ENV_LOADED"
  | get "DOTFILES_ENV_LOADED"
) != "true" {
{{- with $envs := (includeTemplate ".chezmoienvironments/linux.tmpl" .) }}
{{-   $envs
      | replaceAllRegex "^" "\n"
      | replaceAllRegex "\\$\\{(.+?):-(.+)\\}" "($$env | default $$'$2' \"$1\" | get \"$1\")"
      | replaceAllRegex "\\$\\{(.+?)\\}" "($$env.$1)"
      | replaceAllRegex "\n(.*?)=\"(.+)\"" "\n  $$env.$1 = $\"$2\""
 }}
{{- end -}}
}
